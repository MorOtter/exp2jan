<!DOCTYPE html>
<html lang="en">
  <!-- ... head section remains the same ... -->
  <body>
    <!-- ... navigation remains the same ... -->

    <section class="info">
      <h1>Consent Form</h1>
      <h2><b>Name of Lead Investigator:</b> Mordecai Otter</h2>
      <br />
      <!-- ... other intro paragraphs remain the same ... -->

      <section class="consent">
        <div class="d-flex w-100 justify-content-between">
          <input
            type="checkbox"
            class="form-check-input consent-checkbox"
            id="consent-1"
            name="consent-checkbox"
          />
          <label for="consent-1" class="form-check-label">
            I consent to participate in the study conducted by Mordecai Otter of
            Psychology, Cardiff University with the supervision of Prof. Phillip
            Morgan and Prof. Rob Honey.</label>
        </div>
        <br /><br />

        <div class="row align-items-center">
          <div class="col-12 d-flex">
            <input
              type="checkbox"
              class="form-check-input consent-checkbox me-2"
              style="margin-left: -1rem"
              id="consent-2"
              name="consent-checkbox"
            />
            <p class="mb-0">
              I confirm that I have read the information sheet on the previous
              page.
            </p>
          </div>
        </div>
        <br /><br />

        <div class="row align-items-center">
          <div class="col-12 d-flex">
            <input
              type="checkbox"
              class="form-check-input consent-checkbox me-2"
              style="margin-left: -1rem"
              id="consent-3"
              name="consent-checkbox"
            />
            <p class="mb-0">
              I confirm that I understand the information sheet and have had the
              opportunity to ask questions.
            </p>
          </div>
        </div>
        <br /><br />

        <div class="row align-items-center">
          <div class="col-12 d-flex">
            <input
              type="checkbox"
              class="form-check-input consent-checkbox me-2"
              style="margin-left: -1rem"
              id="consent-4"
              name="consent-checkbox"
            />
            <p class="mb-0">
              I understand that my participation is voluntary, and I am free to
              withdraw at any time without giving a reason and without any
              adverse consequences.
            </p>
          </div>
        </div>
        <br /><br />

        <div class="row align-items-center">
          <div class="col-12 d-flex">
            <input
              type="checkbox"
              class="form-check-input consent-checkbox me-2"
              style="margin-left: -1rem"
              id="consent-5"
              name="consent-checkbox"
            />
            <p class="mb-0">
              I consent to the processing of my personal information such as my
              name and course for the purposes explained to me.
            </p>
          </div>
        </div>
        <br /><br />

        <div class="row align-items-center">
          <div class="col-12 d-flex">
            <input
              type="checkbox"
              class="form-check-input consent-checkbox me-2"
              style="margin-left: -1rem"
              id="consent-6"
              name="consent-checkbox"
            />
            <p class="mb-0">
              I understand who will have access to my personal information, how
              the data will be stored, and what will happen to the data at the
              end of the research project.
            </p>
          </div>
        </div>
        <br /><br />

        <div class="row align-items-center">
          <div class="col-12 d-flex">
            <input
              type="checkbox"
              class="form-check-input consent-checkbox me-2"
              style="margin-left: -1rem"
              id="consent-7"
              name="consent-checkbox"
            />
            <p class="mb-0">
              I understand that after the research project, anonymised data may
              be made publicly available via a data repository.
            </p>
          </div>
        </div>
        <br /><br />

        <div class="row align-items-center">
          <div class="col-12 d-flex">
            <input
              type="checkbox"
              class="form-check-input consent-checkbox me-2"
              style="margin-left: -1rem"
              id="consent-8"
              name="consent-checkbox"
            />
            <p class="mb-0">
              I understand how the findings and results of the research project
              will be written up and published.
            </p>
          </div>
        </div>
        <br /><br />

        <!-- Gender and Age selection -->
        <form id="consent-form" action="/participant/login" method="POST">
          <div class="mb-3">
            <label for="gender" class="form-label">What is your gender?</label>
            <select class="form-select" id="gender" name="gender" required>
              <option value="">Please select</option>
              <option value="male">Male</option>
              <option value="female">Female</option>
              <option value="other">Other</option>
              <option value="prefer-not-to-say">Prefer not to say</option>
            </select>
          </div>

          <div class="mb-3">
            <label for="age" class="form-label">What is your age?</label>
            <input
              type="text"
              class="form-control"
              id="age"
              name="age"
              placeholder="Enter age (18-99)"
              required
            />
          </div>
        </form>
      </section>
      <p><b>Thank you for participating in our research.</b></p>
      <p><b>You will receive instructions on how to receive your credits at the top of the debrief page at the end of the study.</b></p>
      <button class="btn" id="proceedToLogin">Confirm</button>
    </section>

    <script>
      // Add event listener for each checkbox to remove warning styling when checked
      document.querySelectorAll('.consent-checkbox').forEach(checkbox => {
        checkbox.addEventListener('click', () => {
          if (checkbox.checked) {
            checkbox.parentElement.classList.remove('border-warning');
          } else {
            checkbox.parentElement.classList.add('border-warning');
          }
        });
      });

      document.getElementById("proceedToLogin").addEventListener("click", (event) => {
        let isValid = true;
        
        // Check all consent checkboxes
        const consentCheckboxes = document.querySelectorAll('.consent-checkbox');
        consentCheckboxes.forEach(checkbox => {
          if (!checkbox.checked) {
            checkbox.parentElement.classList.add('border-danger');
            isValid = false;
          } else {
            checkbox.parentElement.classList.remove('border-danger');
          }
        });
        
        if (!isValid) {
          event.preventDefault();
          window.alert("Please check all consent boxes to proceed");
          return;
        }

        // Validate gender selection
        const gender = document.getElementById("gender");
        if (gender.value === "") {
          gender.classList.add("border-danger");
          event.preventDefault();
          window.alert("Please select your gender");
          return;
        }
        gender.classList.remove("border-danger");

        // Validate age input
        const age = document.getElementById("age");
        const ageValue = age.value.trim();
        const ageNum = parseInt(ageValue);
        
        if (isNaN(ageNum) || ageNum < 18 || ageNum > 99) {
          age.classList.add("border-danger");
          event.preventDefault();
          window.alert("Please enter a valid age between 18 and 99");
          return;
        }
        age.classList.remove("border-danger");

        // If all validation passes, submit the form
        const form = document.getElementById("consent-form");
        form.submit();
      });
    </script>
  </body>
</html>